<div class="parent">
    <div class="sidebar" [class.active]="isSidebarActive">
        <div class="logo-details">
            <img src="logoT.png">
            <div class="logo_name">TerangaGestion</div>
        </div>
        <ul class="nav-links">
            <li>
                <a href="/dashboard">
                    <i class='bx bx-grid-alt'></i>
                    <span class="links_name">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/recensements">
                    <i class='bx bx-box'></i>
                    <span class="links_name">Recensements</span>
                </a>
            </li>
            <li>
                <a href="/evaluation" class="active">
                    <i class='bx bx-calculator'></i>
                    <span class="links_name">Evaluation</span>
                </a>
            </li>
            <li>
                <a href="/locaux">
                    <i class='bx bx-home'></i>
                    <span class="links_name">Biens</span>
                </a>
            </li>
            <li>
                <a href="/proprietaires">
                    <i class='bx bx-user'></i>
                    <span class="links_name">Propriétaires</span>
                </a>
            </li>
            <li>
                <a href="/locataires">
                    <i class='bx bx-user'></i>
                    <span class="links_name">Locataires</span>
                </a>
            </li>
            <li>
                <a href="/utilisateurs">
                    <i class='bx bx-user'></i>
                    <span class="links_name">Utilisateurs</span>
                </a>
            </li>
            <li>
                <a href="/profil">
                    <i class='bx bx-user'></i>
                    <span class="links_name">Profil</span>
                </a>
            </li>

            <li>
                <a href="/parametres">
                    <i class='bx bx-cog'></i>
                    <span class="links_name">Paramètres</span>
                </a>
            </li>
            <li>
                <a href="#"(click)="logout(); $event.preventDefault()">
                    <i class='bx bx-log-out'></i>
                    <span class="links_name">Déconnexion</span>
                </a>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <nav>
            <div class="sidebar-button">
                <i class='bx bx-menu sidebarBtn' (click)="toggleSidebar()"></i>
            </div>

            <div class="nf-circle">NF</div>

        </nav>

        <div class="container">

            <!--Section info enquête-->
            <div id="calcul">
                <h2>Evaluation</h2>
                <label>Enquêteur</label>
                <input type="text" [(ngModel)]="enqueteur" name="enqueteur">
                <label>Date de l'enquête</label>
                <input type="date" [(ngModel)]="dateEnquete" name="dateEnquete">
            </div>

            <!--Section info cadastrales-->
            <div id="calcul">
                <h2>Références cadastrales et situation de la propriété</h2>
                
                <label>Numéro section</label>
                <input type="text" [(ngModel)]="section" name="section" 
                (input)="validateNumSection()">
                <div *ngIf="numSectionError" style="color: red;">
                    {{ numSectionError }}
                </div>
                <label>NICAD</label>
                <input type="text" [(ngModel)]="nicad" name="nicad" #nicadInput="ngModel"
                (input)="validateNicad()">
                <div *ngIf="nicadError" style="color: red;">
                    {{ nicadError }}
                </div>
                <label>Numéro parcelle</label>
                <input type="text" [(ngModel)]="numParcelle" name="numParcelle"
                (input)="validateNumParcelle()">
                <div *ngIf="numParcelleError" style="color: red;">
                    {{ numParcelleError }}
                </div>
                <label>Numéro TF</label>
                <input type="number" [(ngModel)]="numTF" name="numTF">
                <label>Rue</label>
                <input type="text" [(ngModel)]="rue" name="rue">
                <label>Type de construction</label>
                <input type="text" [(ngModel)]="typeConstruction" name="typeConstruction">
                <label>Type de toiture</label>
                <select id="typeToiture" name="typeToiture" [(ngModel)]="typeToiture">
                    <option>Tuile</option>
                    <option>Fibrociment</option>
                    <option>Dalle</option>
                    <option>Tôle galvanisée</option>
                </select>
                <label>Type de sol</label>
                <select id="typeSol" name="typeSol" [(ngModel)]="typeSol">
                    <option>Carrelé</option>
                    <option>Non carrelé</option>
                </select>
                <label>Type de menuiserie</label>
                <select id="typeMenuiserie" name="typeMenuiserie" [(ngModel)]="typeMenuiserie">
                    <option>Aluminium</option>
                    <option>Bois noble</option>
                    <option>Bois fraké ou similaire</option>
                    <option>Bois isoplane</option>
                    <option>Fer forgé</option>
                </select>
                <label>Type de destination</label>
                <input type="text" [(ngModel)]="destination" name="destination">
                <label>Année de construction</label>
                <input type="number" [(ngModel)]="anneeConstruction" name="anneeConstruction">

            </div>

            <!--Section info propriétaire-->
            <div id="calcul">
                <h2>Propriétaire</h2>
                <label>Prénom</label>
                <input type="text" [(ngModel)]="prenom" name="prenom">
                <label>Nom</label>
                <input type="text" [(ngModel)]="nom" name="nom">
                <label>CNI</label>
                <input type="text" [(ngModel)]="cni" name="cni"
                (input)="validateCni()">
                <div *ngIf="cniError" style="color: red;">
                    {{ cniError }}
                </div>
                <label>Profession/Activité</label>
                <input type="text" [(ngModel)]="profession" name="profession">
                <label>NINEA</label>
                <input type="text" [(ngModel)]="ninea" name="ninea">
                <label>Loyer annuel</label>
                <input type="number" [(ngModel)]="loyerAnnuel" name="loyerAnnuel">
                <label>Type de référence</label>
                <select id="typeReference" name="typeReference" [(ngModel)]="typeReference">
                    <option>Résidence principale</option>
                    <option>Résidence secondaire</option>
                </select>
                <label>Statut</label>
                <select id="statut" name="statut" [(ngModel)]="statut">
                    <option>Propriétaire seul</option>
                    <option>Locataire</option>
                    <option>Indivision</option>
                    <option>Co-propriété</option>
                    <option>Titulaire de droit</option>
                </select>
            </div>

            <form>
                <!--Section terrain-->
                <div id="calcul">
                    <h2>Evaluation du terrain</h2>
                    <label>Région</label>
                    <select id="region" name="region" [(ngModel)]="region" (change)="checkInputs3()" required>
                        <option>Dakar</option>
                        <option>Diourbel</option>
                        <option>Fatick</option>
                        <option>Kaffrine</option>
                        <option>Kaolack</option>
                        <option>Kédougou</option>
                        <option>Kolda</option>
                        <option>Louga</option>
                        <option>Matam</option>
                        <option>Saint-Louis</option>
                        <option>Sédhiou</option>
                        <option>Tambacounda</option>
                        <option>Thiès</option>
                        <option>Ziguinchor</option>
                    </select>
                    <div *ngIf="regionError" style="color: red;">
                        {{ regionError }}
                    </div>
                    <label>Département</label>
                    <select id="departement" name="departement" [(ngModel)]="departement" (ngModelChange)="checkInputs1()"
                        required>
                        <option *ngFor="let departement of departements" [value]="departement">{{ departement }}</option>
                    </select>
                    <div *ngIf="departementError" style="color: red;">
                        {{ departementError }}
                    </div>
                    <label>Commune</label>
                    <select id="commune" name="commune" [(ngModel)]="commune" (ngModelChange)="checkInputs()" required>
                        <option *ngFor="let commune of communes" [value]="commune">{{ commune }}</option>
                    </select>
                    <div *ngIf="communeError" style="color: red;">
                        {{ communeError }}
                    </div>
                    <label>Secteur</label>
                    <select id="secteur" name="secteur" [(ngModel)]="secteur" (ngModelChange)="checkInputs2()" required>
                        <option *ngFor="let secteur of secteurs" [value]="secteur">{{ secteur }}</option>
                    </select>
                    <div *ngIf="secteurError" style="color: red;">
                        {{ secteurError }}
                    </div>
                    <label>Zone</label>
                    <select id="zone" name="zone" [(ngModel)]="zone" required>
                        <option *ngFor="let zone of zones" [value]="zone">{{ zone }}</option>
                    </select>
                    <div *ngIf="zoneError" style="color: red;">
                        {{ zoneError }}
                    </div>
                    <label>Surface du terrain (m2)</label>
                    <input type="number" [(ngModel)]="surfaceTerrain" name="surfaceTerrain">
                    <label>Surface bâtie (m2)</label>
                    <input type="number" [(ngModel)]="surfaceBatie" name="surfaceBatie">

                    <button type="button" class="evaluer" (click)="evaluerTerrain()">Evaluer</button>
                    <p>
                        <strong>Surface non bâtie: </strong> <span>{{surfaceNonBatie}}</span>
                        <strong>Prix du m2 non bâti: </strong> <span>{{prixM2NonBati}}</span>
                        <strong>Valeur du sol non bâti: </strong> <span>{{valeurSolNonBati}}</span>


                    </p>
                    <p>
                        <strong>Prix du m2 bâti: </strong> <span>{{this.prixM2Bati}}</span>
                        <strong>Valeur du sol bâti: </strong> <span>{{valeurSolBati}}</span>
                        <strong>Valeur totale du sol: </strong> <span>{{valeurSolTotal}}</span>


                    </p>
                </div>
            </form>

            <form id="formulaireCalculEte">
                <!-- Section 2: local -->
                <div id="calcul">
                    <h2>Evaluation du bien</h2>
                    <label>Région</label>
                    <select id="region" name="region" [(ngModel)]="region" (change)="checkInputs3()" required>
                        <option>Dakar</option>
                        <option>Diourbel</option>
                        <option>Fatick</option>
                        <option>Kaffrine</option>
                        <option>Kaolack</option>
                        <option>Kédougou</option>
                        <option>Kolda</option>
                        <option>Louga</option>
                        <option>Matam</option>
                        <option>Saint-Louis</option>
                        <option>Sédhiou</option>
                        <option>Tambacounda</option>
                        <option>Thiès</option>
                        <option>Ziguinchor</option>
                    </select>
                    <div *ngIf="regionError" style="color: red;">
                        {{ regionError }}
                    </div>
                    <label>Type immeuble</label>
                    <select id="typeImmeuble" name="typeImmeuble" [(ngModel)]="typeImmeuble"
                        (change)="updateCategories()">
                        <option>Individuel</option>
                        <option>Collectif</option>
                    </select>
                    <label>Surface de l'assise au sol (en m2)</label>
                    <input type="number" [(ngModel)]="surfaceBatie" name="surfaceBatie" required>
                    <label>Surface balcon (en m2)</label>
                    <input type="number" [(ngModel)]="surfaceBalcon" name="surfaceBalcon" required>
                    <label>Nombre de niveaux</label>
                    <input type="number" [(ngModel)]="nbNiveau" name="nbNiveau" required>
                    <label>Nombre d'années</label>
                    <input type="number" [(ngModel)]="nbAnnee" name="nbAnnee" required>
                    <label>Catégorie</label>
                    <select [(ngModel)]="categorie" name="categorie" required>
                        <option *ngFor="let cat of categories" [value]="cat">{{cat}}</option>
                    </select>
                    <label>Coef entretien/vétusté</label>
                    <select [(ngModel)]="coefVet" name="coefVet" required>
                        <option>0.3</option>
                        <option>0.4</option>
                        <option>0.5</option>
                        <option>0.6</option>
                        <option>0.7</option>
                        <option>0.8</option>
                        <option>0.9</option>
                        <option>1</option>
                    </select>
                    <label>Coef voisinage</label>
                    <select [(ngModel)]="coefVoi" name="coefVoi" required>
                        <option>0.8</option>
                        <option>0.9</option>
                        <option>1</option>
                        <option>1.1</option>
                    </select>
                    <button type="button" class="evaluer" (click)="evaluerLocal()">Evaluer</button>
                    <p>
                        <strong>Surface hors oeuvre: </strong> <span>{{surfaceHorsOeuvre}}</span>
                        <strong>Surface utile: </strong> <span>{{surfaceUtile}}</span>
                        <strong>Abattement d'ancienneté: </strong> <span>{{abattement}}</span>


                    </p>
                    <p>
                        <strong>Surface corrigée: </strong> <span>{{surfaceCorrigee}}</span>
                        <strong>Prix du m2: </strong> <span>{{prixM2Local}}</span>
                        <strong>Valeur du bien: </strong> <span>{{valeurLocal}}</span>

                    </p>
                </div>

            </form>
            <form>
                <!--Section cours-->
                <div id="calcul">
                    <h2>Evaluation des cours</h2>
                    <label>Surface réelle</label>
                    <input type="number" [(ngModel)]="surfaceReelleCours" name="surfaceReelleCours" required>
                    <label>Coef entretien/vétusté</label>
                    <select [(ngModel)]="coefVetCours" name="coefVetCours" required>
                        <option>0.3</option>
                        <option>0.4</option>
                        <option>0.5</option>
                        <option>0.6</option>
                        <option>0.7</option>
                        <option>0.8</option>
                        <option>0.9</option>
                        <option>1</option>
                    </select>
                    <label>Catégorie</label>
                    <select [(ngModel)]="categorieCours" name="categorieCours" required>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                    </select>

                    <button type="button" class="evaluer" (click)="evaluerCours()">Evaluer</button>
                    <p>
                        <strong>Surface corrigée: </strong> <span>{{surfaceCorrigeeCours}}</span>
                        <strong>Prix du m2: </strong> <span>{{prixM2Cours}}</span>
                        <strong>Valeur des cours: </strong> <span>{{valeurCours}}</span>

                    </p>


                </div>
            </form>
            <form>
                <!--Section Clôture-->
                <div id="calcul">
                    <h2>Evaluation des clôtures</h2>
                    <label>Surface réelle</label>
                    <input type="number" [(ngModel)]="surfaceReelleCloture" name="surfaceReelleCloture" required>
                    <label>Coef entretien/vétusté</label>
                    <select [(ngModel)]="coefVetCloture" name="coefVetCloture" required>
                        <option>0.3</option>
                        <option>0.4</option>
                        <option>0.5</option>
                        <option>0.6</option>
                        <option>0.7</option>
                        <option>0.8</option>
                        <option>0.9</option>
                        <option>1</option>
                    </select>
                    <label>Catégorie</label>
                    <select [(ngModel)]="categorieCloture" name="categorieCloture" required>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                    </select>
                    <button type="button" class="evaluer" (click)="evaluerCloture()">Evaluer</button>
                    <p>
                        <strong>Surface corrigée: </strong> <span>{{surfaceCorrigeeCloture}}</span>
                        <strong>Prix du m2: </strong> <span>{{prixM2Cloture}}</span>
                        <strong>Valeur des clôtures: </strong> <span>{{valeurCloture}}</span>
                    </p>


                </div>
            </form>
            <form>
                <!--Section Amenagement particulier-->
                <div id="calcul">
                    <h2>Evaluation des aménagements particuliers</h2>
                    <label>Coût estimatif</label>
                    <input type="number" [(ngModel)]="coutEstimatif" name="coutEstimatif" required>
                    <label>Surface réelle</label>
                    <input type="number" [(ngModel)]="surfaceReelleAmenagement" name="surfaceReelleAmenagement">
                    <label>Coef entretien/vétusté</label>
                    <select [(ngModel)]="coefVetAmenagement" name="coefVetAmenagement" required>
                        <option>0.3</option>
                        <option>0.4</option>
                        <option>0.5</option>
                        <option>0.6</option>
                        <option>0.7</option>
                        <option>0.8</option>
                        <option>0.9</option>
                        <option>1</option>
                    </select>
                    
                    <label>Date de réalisation</label>
                    <input type="date" [(ngModel)]="dateRealisation" name="dateRealisation">
                    <label>Date de réévaluation</label>
                    <input type="date" [(ngModel)]="dateReevaluation" name="dateReevaluation">

                    <button type="button" class="evaluer" (click)="evaluerAmenagementParticulier()">Evaluer</button>

                    <p>
                        <strong>Surface corrigée: </strong> <span>{{surfaceCorrigeeAmenagement}}</span>
                        <strong>Valeur des aménagements particuliers: </strong>
                        <span>{{valeurAmenagementParticulier}}</span>
                    </p>

                </div>
            </form>
            <form>
                <!--Section Amenagement particulier-->
                <div id="calcul">
                    <h2>Evaluation des dépendances</h2>
                    <label>Surface réelle</label>
                    <input type="number" [(ngModel)]="surfaceReelleDependance" name="surfaceReelleDependance" required>
                    <label>Coef entretien/vétusté</label>
                    <select [(ngModel)]="coefVetDependance" name="coefVetDependance">
                        <option>0.3</option>
                        <option>0.4</option>
                        <option>0.5</option>
                        <option>0.6</option>
                        <option>0.7</option>
                        <option>0.8</option>
                        <option>0.9</option>
                        <option>1</option>
                    </select>
                    <label>Catégorie</label>
                    <select [(ngModel)]="categorieDependance" name="categorieDependance">
                        <option *ngFor="let catt of categories" [value]="catt">{{catt}}</option>
                    </select>
                    <button type="button" class="evaluer" (click)="evaluerDependance()">Evaluer</button>

                    <p>
                        <strong>Surface corrigée: </strong> <span>{{surfaceCorrigeeDependance}}</span>
                        <strong>Prix du m2: </strong> <span>{{prixM2Local}}</span>
                        <strong>Valeur des dépendances: </strong><span>{{valeurDependance}}</span>
                    </p>

                </div>
            </form>
            <!--Section Pdf à générer-->
            <!-- Conteneur principal du rapport PDF avec référence ViewChild -->
            <div #calcul id="calcul" class="pdf-container">
                <header>
                    <!-- <figure>
                        <img src="assets/logo_ministere_finance.png" alt="Logo Ministère des Finances"/>
                        <figcaption>DIRECTION GÉNÉRALE DES IMPÔTS ET DOMAINES</figcaption>
                        <div class="subtitle">DIRECTION DU CADASTRE</div>
                    </figure> -->
                    <h1 class="pdf"></h1>
                    <div class="document-id">Rapport d'évaluation cadastrale</div>
                </header>
                <div class="report-content">
                       
    
                        
                        <section class="receiver">
                            <h3>Propriétaire</h3>
                            <div class="text-content">
                                <p><strong>Prenom : </strong>{{prenom}}</p>
                                <p><strong>Nom : </strong> {{nom}}</p>
                                <p><strong>Profession : </strong>{{profession}}</p>
                                <p><strong>CNI :</strong>{{cni}}</p>
                                <p><strong>NINEA: </strong>{{ninea}}</p>
                                <p><strong>Type de référence :</strong> {{typeReference}}</p>
                                <p><strong>Loyer annuel :</strong> <span class="value-highlight">{{loyerAnnuel}} FCFA</span></p>
                            </div>
                        </section>
                        <section class="receiver">
                            <h3>Evaluation du terrain</h3>
                            <div class="text-content">
                                <p>Le terrain est situé dans la zone <strong>{{zone || '...'}} </strong> du secteur <strong>{{secteur || '...'}}</strong> dans la commune de <strong>{{commune || '...'}}</strong>, département de <strong>{{departement || '...'}}</strong>, région de <strong>{{region || '...'}}</strong>.</p>
                                <p><strong>Surface non bâtie :</strong> {{surfaceNonBatie}} m²</p>
                                <p><strong>Valeur sol total :</strong> <span class="value-highlight">{{valeurSolTotal}} FCFA</span></p>
                            </div>
                        </section>
                        <section class="receiver">
                            <h3>Evaluation du bien</h3>
                            <div class="text-content">
                                <p>Le bien est de catégorie <strong>{{categorie || '...'}}</strong>, de type <strong>{{typeImmeuble || '...'}}</strong> La construction est de type <strong>{{typeConstruction || '...'}}</strong> avec une toiture en <strong>{{typeToiture || '...'}}</strong>Le sol est en <strong>{{typeSol || '...'}}</strong> et la menuiserie est en <strong>{{typeMenuiserie || '...'}}</strong> Ce bien a été construit en : <strong>{{anneeConstruction || '...'}}</strong></p>
                                <p><strong>NICAD :</strong> {{nicad}}</p>
                                <p><strong>Surface bâtie :</strong> {{surfaceBatie}} m²</p>
                                <p><strong>Valeur du bien :</strong> <span class="value-highlight">{{valeurLocal}} FCFA</span></p>
                            </div>
                        </section>
                        <!--A partir de cette section, le contenu sera mis dans la page suivante donc on aura un pdf avec deux pages-->
                        <section class="receiver new-page">
                            <h3>Evaluation des cours, clôtures, dépendances et aménagements particuliers</h3>
                            <div class="text-content">
                                <p>La propriété comprend des cours d'une surface de <strong>{{surfaceReelleCours || '...' }} m²</strong> et des clôtures d'une surface de <strong>{{surfaceReelleCloture || '...' }} m².</strong></p>
                                <p><strong>Valeur des cours :</strong> {{valeurCours}} FCFA</p>
                                <p><strong>Valeur des clôtures :</strong> {{valeurCloture}} FCFA</p>
                                <p><strong>Valeur des dépendances :</strong> {{valeurDependance}} FCFA</p>
                                <p><strong>Valeur des aménagements particuliers :</strong> <span class="value-highlight">{{valeurAmenagementParticulier}} FCFA</span></p>
                            </div>
                        </section>
                        <section class="receiver">
                            <h3>Evaluation de l'immeuble</h3>
                            <div class="text-content">
                                <p>L'évaluation finale de l'immeuble prend en compte l'ensemble des éléments précédents pour déterminer sa valeur locative.</p>
                                <p><strong>Valeur totale de l'immeuble :</strong> <span class="value-highlight">{{valeurImmeuble}} FCFA</span></p>
                                <p><strong>Taux appliqué :</strong> {{taux}}%</p>
                                <p class="total-value-text"><strong>Valeur locative :</strong> <span class="value-highlight">{{valeurLocative}} FCFA</span></p>
                            </div>
                        </section>
                    </div><!-- /.report-content -->
                    
                    <footer>
                        <div class="signature-section">
                            <div class="signature-box">
                                <p>L'Agent Évaluateur</p>
                             
                                <p class="name">{{enqueteur || ''}}</p>
                            </div>
                            <div class="signature-box">
                                <p>Le Chef de Service</p>
                               
                                <p class="name"></p>
                            </div>
                        </div>
                       
                    </footer>
            </div>
            <div class="button-container">
                <button type="button" class="exporter" (click)="exportToPDF()">Exporter en PDF</button>
            </div>
        </div>

    </section>
</div>